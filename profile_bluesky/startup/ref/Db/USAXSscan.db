record(acalcout, "$(P)USAXS$(Q)writeArray") {
	field(NELM, "$(N)")
	field(NUSE, "$(N)")
	field(PREC, "6")
	field(B, "1.e-5")
	field(C, "$(ABS)")
	# for trajectory, absolute position is significant
	#field(CALC, "d:=amax(abs(aa-bb))>b;d")
	# for PSO, only relative position matters
	#field(CALC, "d:=amax(abs((aa-dbl(aa))-(bb-dbl(bb))))>b;d")
	#use C to specify abs (1) or rel (0)
	field(CALC, "d:=amax(abs((aa-(c?0:dbl(aa)))-(bb-(c?0:dbl(bb)))))>b;d")
	field(OCAL, "bb:=(d?aa:bb);aa")
	field(OOPT, "When Non-zero")
	field(DOPT, "Use OCAL")
	field(OUT, "$(OUTPV) PP")
}
record(aSub, "$(P)USAXS$(Q)calc") {
	field(SNAM, "USAXSscan")
	field(PREC, "5")

	# A - center value for AR stage
	field(FTA, "DOUBLE")
	field(INPA, "$(P)USAXS:ARcenter CP")

	# B - number of points
	field(FTB, "LONG")
	field(INPB, "$(NPTS_PV) CP")

	# C - weighing value... Changes spread of the log stepping
	field(FTC, "DOUBLE")
	field(INPC, "$(P)USAXS:UATerm CP")

	# D - angle offset to start above AR_VAL_CENTER
	field(FTD, "DOUBLE")
	field(INPD, "$(P)USAXS:StartOffset CP")

	# E - end Q for USAXS scans
	field(FTE, "DOUBLE")
	field(INPE, "$(P)USAXS:Finish CP")

	# F - min step of uascan
	field(FTF, "DOUBLE")
	#field(INPF, "$(P)USAXS:MinStep CP")
	field(INPF, "$(MINSTEP_PV) CP")

	# G - beam energy (keV)
	field(FTG, "DOUBLE")
	field(INPG, "$(ENERGY_PV) CP")

	# VALG - output array
	field(FTVG, "DOUBLE")
	field(NOVG, "$(N)")
	field(OUTG, "$(P)USAXS$(Q)writeArray.AA PP")

	# H - debug
	field(FTH, "LONG")

}

